@page "/"

<PageTitle>ngIcons for Blazor</PageTitle>

<div class="hero">
    <div class="hero__copy">
        <p class="pill">Blazor x ng-icons</p>
        <h1>ngIcons for Blazor</h1>
        <p class="lede">Browse every ng-icons pack, preview SVGs, and copy markup ready for your components.</p>
        <div class="hero__actions">
            <a class="primary" href="https://ng-icons.github.io/ng-icons/#/" target="_blank" rel="noreferrer">Original library</a>
            <a class="ghost" href="https://github.com/ng-icons" target="_blank" rel="noreferrer">Project repo</a>
        </div>
    </div>
    <div class="hero__badge">@ActiveLibrary.DisplayName</div>
</div>

<div class="content-shell">
    <aside class="library-panel">
        <div class="panel-title">Libraries</div>
        <div class="library-list">
            @foreach (var entry in IconCatalog.Libraries)
            {
                <button class="library-chip @(entry == ActiveLibrary ? "active" : string.Empty)" style="--accent:@entry.Accent" @onclick="() => SetLibrary(entry)">
                    <span>@entry.DisplayName</span>
                    <span class="count">@entry.Library.Icons.Count</span>
                </button>
            }
        </div>
    </aside>

    <section class="icons-panel">
        <div class="filter-bar">
            <div class="filter-input">
                <input @bind="Search" @bind:event="oninput" placeholder="Search icons by name" />
            </div>
            <div class="filter-meta">
                <span class="pill">@ActiveLibrary.DisplayName</span>
                <span class="pill">Showing @VisibleIcons.Count of @FilteredCount</span>
            </div>
        </div>

        @if (VisibleIcons.Count == 0)
        {
            <div class="empty">No icons match that search.</div>
        }
        else
        {
            <div class="icon-grid">
                @foreach (var icon in VisibleIcons)
                {
                    <IconTile Icon="icon" Library="@ActiveLibrary.DisplayName" Accent="@ActiveLibrary.Accent" />
                }
            </div>
            @if (FilteredCount > VisibleIcons.Count)
            {
                <p class="muted">Showing the first @VisibleIcons.Count results. Narrow your search to load fewer icons.</p>
            }
        }
    </section>
</div>

@code {
    private const int MaxVisible = 400;
    private IconLibraryEntry ActiveLibrary { get; set; } = IconCatalog.Libraries.First(l => l.Library.Icons.Count > 0);
    private List<IconDefinition> VisibleIcons { get; set; } = new();
    private int FilteredCount { get; set; }
    private string _search = string.Empty;
    private string Search
    {
        get => _search;
        set
        {
            _search = value;
            RefreshIcons();
        }
    }

    protected override void OnInitialized()
    {
        RefreshIcons();
    }

    private void SetLibrary(IconLibraryEntry entry)
    {
        ActiveLibrary = entry;
        RefreshIcons();
    }

    private void RefreshIcons()
    {
        var filtered = ActiveLibrary.Library.Icons.Values
            .Where(icon => string.IsNullOrWhiteSpace(Search) || icon.Name.Contains(Search, StringComparison.OrdinalIgnoreCase))
            .OrderBy(icon => icon.Name)
            .ToList();

        FilteredCount = filtered.Count;
        VisibleIcons = filtered.Take(MaxVisible).ToList();
        StateHasChanged();
    }

}
