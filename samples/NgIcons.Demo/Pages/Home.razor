@page "/"
@using Microsoft.AspNetCore.Components.Web.Virtualization

@* Title updated by extract-icons.ts script *@
<PageTitle>76785 icons for Blazor apps</PageTitle> 

<div class="mt-5 rounded-2xl p-7 bg-gradient-to-br from-purple-700/40 to-cyan-600/20 border border-white/15 flex items-center justify-between gap-5 flex-wrap">
    <div>
        <p class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 text-gray-200 font-semibold text-sm">Blazor x ng-icons</p>
        <h1 class="my-2 text-3xl font-bold text-white">ngIcons for Blazor</h1>
        <p class="text-slate-400 max-w-xl">Browse every ng-icons pack, preview SVGs, and copy markup ready for your components.</p>
        <code class="block mt-3 px-3 py-2 rounded-lg bg-black/50 text-sm text-gray-300 font-mono border border-white/10">dotnet add package NgIcons.@ActiveLibrary.DisplayName.Replace(" ", "")</code>
        <div class="flex gap-3 mt-4">
            <a href="https://ng-icons.github.io/ng-icons/#/" target="_blank" rel="noreferrer"
               class="px-4 py-2.5 rounded-xl border border-white/10 bg-purple-500 text-slate-900 font-bold hover:opacity-90 transition-opacity">Original library</a>
            <a href="https://github.com/ng-icons-for-blazor/ng-icons-for-blazor-demo" target="_blank" rel="noreferrer"
               class="px-4 py-2.5 rounded-xl border border-white/10 text-gray-200 font-semibold hover:border-white/20 transition-colors">Project repo</a>
        </div>
    </div>
    <div class="px-4 py-2.5 rounded-xl border border-white/10 bg-black/40 font-semibold text-white">@ActiveLibrary.DisplayName</div>
</div>

<div class="mt-5 grid grid-cols-1 lg:grid-cols-[280px_1fr] gap-4">
    <aside class="border border-white/10 rounded-2xl bg-panel p-4 h-fit">
        <div class="font-bold mb-3">Libraries</div>
        <div class="scrollbar flex flex-col gap-2 max-h-[70vh] overflow-auto pr-1.5 lg:max-h-[70vh]">
            @foreach (var entry in IconCatalog.Libraries)
            {
                <button @onclick="() => SetLibrary(entry)"
                        class="w-full bg-white/5 border rounded-xl px-3 py-2.5 flex justify-between items-center font-semibold transition-all hover:-translate-y-0.5
                               @(entry == ActiveLibrary ? "border-purple-500 shadow-[0_0_0_1px_rgb(168,85,247)]" : "border-white/10 hover:border-white/15")">
                    <span class="text-gray-200">@entry.DisplayName</span>
                </button>
            }
        </div>
    </aside>

    <section class="border border-white/10 rounded-2xl bg-panel p-4">
        @if (ActiveLibrary.HasSuffixes)
        {
            <div class="flex gap-2 mb-3 flex-wrap">
                @foreach (var suffix in ActiveLibrary.Suffixes)
                {
                    <button @onclick="() => SetSuffix(suffix)"
                            class="px-3 py-1.5 rounded-lg border font-medium text-sm transition-all
                                   @(suffix == ActiveSuffix ? "border-purple-500 bg-purple-500/20 text-purple-300" : "border-white/10 bg-white/5 text-gray-300 hover:border-white/20")">
                        @(string.IsNullOrEmpty(suffix) ? "default" : suffix)
                    </button>
                }
            </div>
        }
        <div class="flex flex-wrap gap-3 items-center justify-between mb-3">
            <div class="flex-1 min-w-[260px]">
                <input @bind="Search" @bind:event="oninput" placeholder="Search icons by name"
                       class="w-full px-3.5 py-3 rounded-xl border border-white/10 bg-slate-950 text-gray-200 placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-purple-500" />
            </div>
            <div class="flex gap-2 items-center flex-wrap">
                <span class="px-3 py-1.5 rounded-full bg-white/10 text-gray-200 font-semibold text-sm">@ActiveLibrary.DisplayName</span>
                <span class="px-3 py-1.5 rounded-full bg-white/10 text-gray-200 font-semibold text-sm">@FilteredIcons.Count icons</span>
            </div>
        </div>

        @if (FilteredIcons.Count == 0)
        {
            <div class="text-slate-400 py-3">No icons match that search.</div>
        }
        else
        {
            <div class="scrollbar icon-grid-virtualized">
                <Virtualize Items="IconRows" Context="row" ItemSize="88" OverscanCount="2">
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-3 pb-3">
                        @foreach (var icon in row)
                        {
                            <IconTile Icon="icon" Accent="@ActiveLibrary.Accent" />
                        }
                    </div>
                </Virtualize>
            </div>
        }
    </section>
</div>

@code {
    private const int IconsPerRow = 5;
    private IconLibraryEntry ActiveLibrary { get; set; } = IconCatalog.Libraries[0];
    private string ActiveSuffix { get; set; } = "";
    private List<IconDefinition> FilteredIcons { get; set; } = new();
    private List<IconDefinition[]> IconRows { get; set; } = new();
    private string _search = string.Empty;
    private string Search
    {
        get => _search;
        set
        {
            _search = value;
            RefreshIcons();
        }
    }

    protected override void OnInitialized()
    {
        ActiveSuffix = ActiveLibrary.HasSuffixes ? ActiveLibrary.Suffixes[0] : "";
        RefreshIcons();
    }

    private void SetLibrary(IconLibraryEntry entry)
    {
        ActiveLibrary = entry;
        ActiveSuffix = entry.HasSuffixes ? entry.Suffixes[0] : "";
        RefreshIcons();
    }

    private void SetSuffix(string suffix)
    {
        ActiveSuffix = suffix;
        RefreshIcons();
    }

    private void RefreshIcons()
    {
        var library = ActiveLibrary.HasSuffixes
            ? ActiveLibrary.GetLibrary(ActiveSuffix)
            : ActiveLibrary.Library;

        FilteredIcons = library.Icons.Values
            .Where(icon => string.IsNullOrWhiteSpace(Search) || icon.Name.Contains(Search, StringComparison.OrdinalIgnoreCase))
            .OrderBy(icon => icon.Name)
            .ToList();

        IconRows = FilteredIcons
            .Chunk(IconsPerRow)
            .ToList();

        StateHasChanged();
    }
}
